# data-loading
Code to load data properly, organised per programming language in their own folder.

Note that all these example will not run ootb (out of the box) on CBS's servers (since you do not have the rights to change the working directory), but you should be able to run them without a problem on your own computer (provided that you have installed the packages the scripts rely on.)

## Files in codebook_cbs_R
This directory contains premade scripts/syntaxes that can be used to load-in data in the servers of CBS. Feel free to send a request to DCC if you think a useful script is missing or could be improved!

The project column contains the projects that can use this function. This was not verified, and we only took 9002 and 9003 in account.

| Name | Function | CBS-Project |
|------|----------|---------|
| cbs_get_household_income.R | Get the household income | 9002 |
| cbs_get_personal_income.R | Get personal income income | 9002 |
| cbs_get_latest_sav_files.R | Get the latest sav files from one or multiple folders while also taking into account the different years. | all |
| cbs_get_med.R | Get data on medication | all |
| cbs_get_prim_cause_of_death.R | An example on how to deal with multiple data sets. | 9002 & 9003 |
| example_cbs_combining_several_datasets.RMD | Get the primary cause of death. | 9002 & 9003 |
| cbs_save_diagnoses_to_parquet.R | Generate parquet files from the VEKTIS data on diagnoses. | all |
| example_cbs_select_diagnoses.RMD | example how to efficiently select patients with medical conditions of interest | all |
| cbs_save_healthcare_to_parquet.R | Generate parquet files with the healthcare costs from VEKTIS | all |
| cbs_get_gen_parquet_files.R | Function that allows you to read in either the healthcare costs or diagnoses parquet files as generated by the 2 functions above | all |
| cbs_get_residents.R | Get all residents for all years for municipalities of interest | 9002 & 9003 |
| get_latest_sav_file.R | Get the latest sav file from a folder | all |
| processing_lab_files/get_lab_measurements.R | file that converts that gets data from LAB files (RDS) based on certain dWCIAnumbers | 9002 |
| processing_lab_files/get_numeric_lab_measurements.R | File that cleans up the data for a given dWCIAnumber and converts them to numeric. Do adapt this to your needs. | 9002 |
| processing_lab_files/get_numeric_bmi.R | A method of retrieving the BMI from the data that also calculates it from available data on height and weight | 9002 |
| processing_lab_files/example_lab_numeric_measurements.RMD | an example on how to get numeric lab measurements. This uses get_lab_measurements.R and get_numeric_bmi.R | 9002 |
| processing_lab_files/lab_date_cleanup.R | Function that gets the actual starting and ending date for the patient population in the GP data | 9002 | 


## Files of interest in folder code_examples_R
| Name | Function |
|------|----------|
| load_single_sav_file.Rmd | Example of reading in a single sav file |
| load_multiple_sav_files.Rmd | Examples of reading in multiple sav files. |
| get_sav_files_from_dir.Rmd | Example of getting the paths of all sav files nested in a dir. |
| loading_saving_parquet_dir.Rmd | Use this example to decrease your load time. |
 get_newest_sav_from_dir.Rmd | An example on how to get the latest sav file form a directory. |


## Reading dirty csv files
Some R packages can not handle a csv file with extra quotes and will return only part of the file. See 20240506_reading_dirty_csv

## Files of interest in folder code_examples_Py
In order to run the files from home (easily), clone the repo to your local machine. If you have pip installed, you can activate whatever environment you want to use for Python, and type:

```
pip install -r requirements.txt
```

| Name | Function |
|------|----------|
| load_multiple_sav_files.Rmd | Examples of reading in multiple sav files. |
| get_sav_files_from_dir.Rmd | Example of getting the paths of all sav files nested in a dir. |
| loading_saving_parquet_dir.Rmd | Use this example to increase your load time. It shows you how to read in and save parquet files in addition to converting a sav file to the Apache Parquet format. |
| get_newest_sav_from_dir.Rmd | An example on how to get the latest sav file form a directory. |
